# 🎓 자동 학급 편성 프로그램

학생들을 공정하고 균형있게 학급에 배정하는 자동화 시스템

---

## 📖 목차

1. [이 프로그램은 무엇인가요?](#이-프로그램은-무엇인가요)
2. [💿 설치 및 실행 방법](#-설치-및-실행-방법)
3. [🚀 빠른 시작 가이드](#-빠른-시작-가이드)
4. [기본 사용법](#기본-사용법)
5. [🎯 수동 조정 기능](#-수동-조정-기능)
6. [파일 형식 이해하기](#파일-형식-이해하기)
7. [❓ 자주 묻는 질문](#-자주-묻는-질문)
8. [🔧 문제 해결 가이드](#-문제-해결-가이드)
9. [부록: 개발자를 위한 정보](#부록-개발자를-위한-정보)

---

## 이 프로그램은 무엇인가요?

이 프로그램은 학생 명단과 분반/합반 규칙을 기반으로 **자동으로 학급을 편성**해주는 도구입니다.

### 핵심 원칙
- ✅ **공정성**: 성적, 성비, 학생 수를 균등하게 배분
- ✅ **규칙 준수**: 분반/합반 규칙 100% 준수
- ✅ **특수 고려**: 특수반 학생, 동명이인, 난이도 학생 특별 배치
- ✅ **투명성**: 전 과정 로그 출력 및 검증 가능

### 주요 특징
1. **자동 배정**: Excel 파일만 준비하면 클릭 한 번으로 배정 완료
2. **수동 조정**: 자동 배정 후 원하는 학생을 자유롭게 이동 가능
3. **규칙 임베딩**: 결과 파일에 규칙이 포함되어 어디서든 수정 가능
4. **범용성**: 모든 학년에 사용 가능 (학년 자동 감지)

---

## 💿 설치 및 실행 방법

이 프로그램을 실행하는 세 가지 방법이 있습니다. 상황에 맞는 방법을 선택하세요.

### 📊 방법 비교표

| 방법 | 난이도 | 대상 | 장점 | 단점 |
|------|-------|------|------|------|
| 1. 실행 파일 다운로드 | ⭐ 쉬움 | 일반 사용자 | Python 설치 불필요 | 파일 크기 큼 |
| 2. Python으로 실행 | ⭐⭐ 보통 | 개발 환경 있음 | 빠른 실행, 수정 가능 | Python 설치 필요 |
| 3. 소스에서 빌드 | ⭐⭐⭐ 어려움 | 개발자, 배포자 | 커스터마이징 가능 | 빌드 시간 소요 |

---

### 방법 1: 실행 파일 다운로드 (권장) ⭐

**가장 쉬운 방법입니다. Python 설치 없이 바로 사용 가능합니다.**

#### 다운로드

1. **Releases 페이지 방문**
   - GitHub 저장소: https://github.com/surida/Class_Assignment
   - 우측 "Releases" 클릭

2. **최신 버전 다운로드**
   - Windows: `학급편성-v2.5-windows.zip` 다운로드
   - macOS: `학급편성-v2.5-macos.zip` 다운로드

3. **압축 해제**
   - 다운로드한 파일을 원하는 위치에 압축 해제

#### 실행

**Windows**:
1. `학급편성.exe` 더블클릭
2. "Windows의 PC 보호" 경고 나오면:
   - "추가 정보" 클릭 → "실행" 클릭

**macOS**:
1. `학급편성.app` 더블클릭
2. 보안 경고 나오면:
   - 우클릭 → "열기" → "열기" 버튼 클릭
   - 또는: 시스템 설정 → 개인정보 보호 및 보안 → "확인 없이 열기"

---

### 방법 2: Python으로 직접 실행 ⭐⭐

**Python이 설치되어 있다면 빠르게 실행할 수 있습니다.**

#### 사전 요구사항

- Python 3.9 이상
- pip (Python 패키지 관리자)

#### 설치 및 실행

**1단계: 저장소 클론**
```bash
git clone https://github.com/surida/Class_Assignment.git
cd Class_Assignment
```

**2단계: 의존성 설치**
```bash
# 필수 라이브러리 설치
pip3 install PyQt6 pandas openpyxl numpy

# 또는 requirements.txt 사용
pip3 install -r requirements.txt
```

**3단계: 프로그램 실행**

**GUI 버전 실행 (권장)**:
```bash
python3 class_assigner_gui_qt.py
```

**콘솔 버전 실행** (고급 사용자):
```bash
# 같은 폴더에 입력 파일이 있어야 함
python3 class_assigner.py
```

#### 장점
- 빠른 실행 (빌드 불필요)
- 코드 수정 가능
- 최신 버전 쉽게 업데이트 (`git pull`)

#### 단점
- Python 환경 설정 필요
- 터미널 사용 필요

---

### 방법 3: 소스에서 빌드 ⭐⭐⭐

**실행 파일(.exe, .app)을 직접 만들고 싶다면 이 방법을 사용하세요.**

#### 사전 요구사항

- Python 3.9 이상
- pip
- PyInstaller

#### 빌드 과정

**공통 준비**:
```bash
# 1. 저장소 클론
git clone https://github.com/surida/Class_Assignment.git
cd Class_Assignment

# 2. 의존성 설치
pip3 install -r requirements.txt
pip3 install pyinstaller
```

**macOS에서 .app 빌드**:
```bash
# 빌드 스크립트 실행 (자동화됨)
chmod +x build.sh
./build.sh

# 결과: dist/학급편성.app 생성
```

**Windows에서 .exe 빌드**:
```cmd
REM PyInstaller로 빌드
pyinstaller --onefile --windowed --name="학급편성" class_assigner_gui_qt.py

REM 결과: dist\학급편성.exe 생성
```

#### 빌드 옵션 설명

- `--onefile`: 모든 것을 하나의 파일로 묶음
- `--windowed`: 콘솔 창 숨김 (GUI만 표시)
- `--name="학급편성"`: 실행 파일 이름 지정

#### 빌드 후

생성된 실행 파일은 `dist/` 폴더에 있습니다:
- macOS: `dist/학급편성.app`
- Windows: `dist\학급편성.exe`

이 파일을 다른 컴퓨터에 복사해서 사용할 수 있습니다.

#### 장점
- 독립 실행 파일 생성
- Python 없는 컴퓨터에서 실행 가능
- 다른 사람에게 배포 가능

#### 단점
- 빌드 시간 소요 (2-5분)
- 파일 크기 큼 (100-200MB)
- 플랫폼별로 별도 빌드 필요

---

### 설치 문제 해결

**Q: Python 버전 확인 방법은?**
```bash
python3 --version
# 또는
python --version
```

**Q: pip가 없다고 나옵니다**
```bash
# macOS/Linux
python3 -m ensurepip --upgrade

# Windows
python -m ensurepip --upgrade
```

**Q: 의존성 설치 시 오류 발생**
```bash
# 관리자 권한으로 설치
sudo pip3 install -r requirements.txt  # macOS/Linux
```

**Q: 빌드한 파일이 실행되지 않습니다**
- macOS: 시스템 설정 → 개인정보 보호 → "확인 없이 열기"
- Windows: "보안 경고" → "추가 정보" → "실행"

---

## 🚀 빠른 시작 가이드

처음 사용하시는 분을 위한 5분 시작 가이드입니다.

### 1단계: 프로그램 실행 (30초)

> **주의**: 먼저 [설치 및 실행 방법](#-설치-및-실행-방법)에서 프로그램을 설치하세요.

**실행 파일 사용 시**:
- Windows: `학급편성.exe` 더블클릭
- macOS: `학급편성.app` 더블클릭

**Python으로 실행 시**:
```bash
python3 class_assigner_gui_qt.py
```

### 2단계: 파일 선택 (1분)

프로그램 창이 열리면:
1. **📚 학생 명단 파일 선택** 버튼 클릭
   - `01 가상 명단.xlsx` 같은 파일 선택
2. **📋 규칙 파일 선택** 버튼 클릭
   - `02 분반 합반할 학생 규칙.xlsx` 선택
3. **🎯 진급할 학급 수** 입력
   - 예: 7개 반으로 편성하려면 `7` 입력

### 3단계: 자동 배정 시작 (2분)

1. **"🚀 학급 편성 시작"** 버튼 클릭
2. 진행 상황이 화면에 표시됩니다:
   ```
   📚 Step 0: 학생 데이터 로드 중...
   ✅ 총 152명의 학생 데이터 로드 완료

   📋 Step 1: 분반/합반 규칙 로드 중...
   ✅ 분반 규칙: 18쌍
   ✅ 합반 규칙: 1그룹

   🎯 Phase 1~5: 배정 중...
   ✅ 배정 완료!
   ```

### 4단계: 결과 확인 (1분)

1. 완료 메시지 확인
2. 입력 파일과 같은 폴더에 `03 배정 결과.xlsx` 파일 생성됨
3. Excel로 열어서 확인:
   - **요약 시트**: 반별 통계
   - **1-1, 1-2...**: 각 반 학생 명단

### 5단계 (선택): 수동 조정

자동 배정 결과가 거의 만족스러운데 일부만 바꾸고 싶다면:
1. 완료 창에서 **"수동 조정 화면으로 이동하시겠습니까?"** → "예" 선택
2. 수동 조정 화면에서 학생을 원하는 반으로 이동
3. **"📥 Export to Excel"** 클릭하여 저장

---

## 기본 사용법

### 파일 준비하기

#### 1. 학생 명단 파일 (`01 가상 명단.xlsx`)

**Excel 파일 구조**:
- **시트**: 현재 학년의 각 반마다 하나씩 (예: `5-1`, `5-2`, `5-3`...)
- **열 구성**:

| 열 이름 | 설명 | 예시 |
|--------|------|------|
| 학년 | 현재 학년 | 5 |
| 반 | 현재 반 번호 | 1, 2, 3... |
| 번호 | 학생 번호 | 1, 2, 3... |
| 이름 | 학생 이름 | 김철수 |
| 성별 | 성별 | 남, 여 |
| 점수 | 성적 점수 | 85 |
| 특수반 | 특수반 여부 | 1 (특수반) 또는 비움 |
| 전출 | 전출 예정 | 1 (전출) 또는 비움 |
| 난이도 | 지도 난이도 | 2.0 (높음) 또는 비움 |
| 비고 | 기타 메모 | 학습부진, 쌍생아 등 |

**중요**:
- 특수반 학생은 가중치 3배로 계산됩니다 (교사 부담 고려)
- 전출 예정 학생은 가중치 0으로 계산됩니다 (실제 교육 대상 아님)

#### 2. 규칙 파일 (`02 분반 합반할 학생 규칙.xlsx`)

**Excel 파일 구조**:
- **시트**: `Sheet1` 하나만 사용
- **두 영역으로 구성**:

**왼쪽: 분반 규칙** (서로 다른 반에 배치)
| 분반해야하는 학생 | | ↔ | | |
|---|---|---|---|---|
| 반 | 이름 | | 반 | 이름 |
| 1 | 김철수 | | 2 | 이영희 |

→ "김철수와 이영희는 **서로 다른 반**에 배치"

**오른쪽: 합반 규칙** (같은 반에 배치)
| 합반해야하는 학생 | | ＋ | | |
|---|---|---|---|---|
| 반 | 이름 | | 반 | 이름 |
| 2 | 박민수 | | 2 | 최지우 |

→ "박민수와 최지우는 **같은 반**에 배치"

**주의사항**:
- 동일한 학생 쌍이 분반과 합반에 동시에 있으면 오류 발생
- 합반 그룹에 동명이인이 있으면 오류 발생

### 결과 확인하기

#### 결과 파일 구조 (`03 배정 결과.xlsx`)

**시트 구성**:
- `요약`: 반별 통계 한눈에 보기
- `1-1`, `1-2`, `1-3`...: 각 반의 학생 명단
- `규칙` ⭐ (NEW): 적용된 분반/합반 규칙 정보

#### 요약 시트 보는 법

| 반 | 학생수 | 유효인원 | 남학생수 | 여학생수 | 난이도합 | 특수반수 |
|---|-------|---------|---------|---------|---------|---------|
| 1-1 | 20 | 22.0 | 8 | 12 | 5.0 | 1 |
| 1-2 | 21 | 24.0 | 10 | 11 | 5.0 | 1 |

**유효 인원이란?**
- 일반 학생: 1명
- 특수반 학생: 3명 (교사 부담 고려)
- 전출 예정: 0명 (실제 교육 대상 아님)
- 예: 학생 20명 중 특수반 1명이면 → 유효 인원 = 19 + 3 = 22명

#### 각 반 시트 보는 법

| 이름 | 성별 | 점수 | 특수반 | 원반 | 원번호 |
|-----|-----|-----|-------|------|-------|
| 강민준 | 남 | 92 | | 5-3 | 12 |
| 김서연 | 여 | 90 | 1 | 5-1 | 8 |

- 학생은 **이름 가나다순**으로 정렬됨
- **원반, 원번호**: 이전 학년 정보 (학생 추적용)

---

## 🎯 수동 조정 기능

자동 배정 결과를 미세 조정할 수 있는 **핵심 기능**입니다.

### 언제 사용하나요?

수동 조정은 다음과 같은 상황에서 유용합니다:

- ✅ 자동 배정 결과가 **거의 만족스러운데** 일부만 조정하고 싶을 때
- ✅ **교사의 직관적 판단**으로 특정 학생을 이동하고 싶을 때
- ✅ **학부모 요청**이나 특별한 사정으로 반 배치를 바꿔야 할 때
- ✅ 성적, 성비 균형을 **수동으로 미세 조정**하고 싶을 때

### 수동 조정 시작하는 두 가지 방법

#### 방법 1: 자동 배정 직후 바로 조정

1. 자동 배정 완료 후 나타나는 대화상자에서
2. **"수동 조정 화면으로 이동하시겠습니까?"** → **"예"** 선택
3. 조정 화면이 자동으로 열립니다

#### 방법 2: 기존 결과 파일 불러오기

1. 프로그램 시작 화면에서
2. **"📂 결과 파일 불러오기 (수동 조정만)"** 버튼 클릭
3. 이전에 저장한 결과 파일 (`03 배정 결과.xlsx`) 선택
4. 조정 화면이 열립니다

**장점**: 규칙 파일 없이도 수동 조정 가능! (결과 파일에 규칙이 포함되어 있음)

### 화면 구성

```
┌─────────────────────┐       ┌─────────────────────┐
│  [왼쪽 패널]        │       │  [오른쪽 패널]      │
│  반 목록            │       │  반 목록            │
│  통계               │   ▶   │  통계               │
│  학생 목록          │   ◀   │  학생 목록          │
│                     │       │                     │
│  1-1반 (20명)       │   이  │  1-2반 (22명)       │
│  🟡 김철수          │   동  │  🔴 박민수          │
│  ⚪ 이영희          │       │  🔵 최지우          │
└─────────────────────┘       └─────────────────────┘
```

**새로운 기능: 대칭형 듀얼 패널**
- **양쪽 모두 반 선택 가능**: 왼쪽과 오른쪽에서 원하는 반을 각각 선택할 수 있습니다.
- **양방향 이동**: 왼쪽 → 오른쪽, 오른쪽 → 왼쪽으로 자유롭게 이동 가능합니다.
- **드래그 앤 드롭**: 마우스로 학생을 끌어서 반대편으로 쉽게 이동할 수 있습니다.

### 학생 이동 방법

**방법 1: 버튼 사용**
1. 왼쪽이나 오른쪽 패널에서 **학생이 있는 반**을 선택합니다.
2. 반대편 패널에서 **이동할 목표 반**을 선택합니다.
3. 학생 목록에서 **이동할 학생**을 선택합니다 (여러 명 선택 가능).
4. 중앙의 **이동 버튼 (▶ 또는 ◀)**을 클릭합니다.

**방법 2: 드래그 앤 드롭**
1. 양쪽 패널에서 출발 반과 도착 반을 각각 선택합니다.
2. 학생 목록에서 학생을 클릭한 상태로 **반대편 목록으로 드래그**합니다.
3. 마우스 버튼을 놓으면 이동이 완료됩니다.

### 색상 표시 의미

학생 이름 옆에 표시되는 색상의 의미:

- 🔴 **빨강**: 특수반 학생
- 🟡 **노랑**: 분반 규칙이 있는 학생 (특정 학생과 **다른 반**이어야 함)
- 🔵 **파랑**: 합반 규칙이 있는 학생 (특정 학생과 **같은 반**이어야 함)
- ⚪ **흰색**: 일반 학생 (특별한 제약 없음)

### 이동 가능한 반 자동 필터링 및 검증

시스템이 자동으로 다음 사항을 검사하여 규칙 위반 시 알림을 표시합니다:

✅ **분반 규칙 검사**: 분반해야 하는 학생과 같은 반이 되면 경고
✅ **동명이인 검사**: 같은 이름 학생이 있는 반으로 이동 시 경고
✅ **합반 규칙 검사**: 합반 그룹 학생을 분리하려고 하면 경고

### ⚠️ 중요한 주의사항

1. **저장 필수**
   - 조정 후 반드시 **"� 저장"** 버튼(오른쪽 하단)을 클릭하여 Excel 파일로 저장하세요.
   - 저장하지 않고 프로그램을 종료하면 조정 내용이 사라집니다.

2. **통계 자동 업데이트**
   - 학생을 이동하면 양쪽 반의 통계(성비, 인원 등)가 즉시 업데이트됩니다.
   - 통계를 보면서 반 간의 균형을 맞춰주세요.

### 예시 시나리오

**상황**: 김철수를 6-1반에서 6-3반으로 옮기고 싶음

**실행**:
```
1. 왼쪽에서 "6-1반" 클릭

2. 가운데 목록에서 "김철수" 클릭
   → 색상 확인: 🟡 (분반 규칙 있음)
   → 제약사항: "분반: 이민준(3반), 박지우(5반)"

3. "→ 다른 반으로 이동" 버튼 클릭

4. 시스템이 자동으로 검사:
   ✅ 6-2반: 이동 가능 (분반 대상 없음)
   ❌ 6-3반: 이동 불가 (이민준이 있음)
   ✅ 6-4반: 이동 가능
   ❌ 6-5반: 이동 불가 (박지우가 있음)
   ✅ 6-6반: 이동 가능
   ✅ 6-7반: 이동 가능

5. 목록에서 "6-4반" 선택

6. 이동 완료!
   → 6-1반 학생 수: 20명 → 19명
   → 6-4반 학생 수: 22명 → 23명
```

**해결 방법** (6-3반으로 보내고 싶었다면):
```
1. 먼저 이민준을 6-3반에서 다른 반으로 이동
2. 그 후 김철수를 6-3반으로 이동
```

---

## 파일 형식 이해하기

### 입력 파일 상세

#### 학생 명단 파일 만들기

**1. Excel 파일 생성**
- 파일명: `01 가상 명단.xlsx` (또는 원하는 이름)

**2. 시트 구성**
- 현재 학년의 각 반마다 하나씩
- 시트 이름 형식: `[학년]-[반]`
- 예: 5학년 7개 반 → `5-1`, `5-2`, `5-3`, `5-4`, `5-5`, `5-6`, `5-7`

**3. 각 시트의 열 구성**

| 열 이름 | 필수 | 설명 | 예시 값 |
|--------|-----|------|--------|
| 학년 | ✅ | 현재 학년 | 5 |
| 반 | ✅ | 현재 반 번호 | 1, 2, 3... |
| 번호 | ✅ | 학생 번호 | 1, 2, 3... |
| 이름 | ✅ | 학생 이름 | 김철수 |
| 성별 | ✅ | 성별 | 남, 여 |
| 점수 | ✅ | 성적 점수 | 85 |
| 특수반 | | 특수반 여부 | 1 또는 비움 |
| 전출 | | 전출 예정 | 1 또는 비움 |
| 난이도 | | 지도 난이도 | 2.0 또는 비움 |
| 비고 | | 기타 메모 | 학습부진, 쌍생아 |

**특수 필드 설명**:
- **특수반**: 특수교육 대상 학생이면 `1`, 아니면 비워둠
- **전출**: 전출 예정 학생이면 `1`, 아니면 비워둠
- **난이도**: 지도 난이도가 높으면 `2.0` 같은 숫자, 보통이면 비워둠

#### 규칙 파일 만들기

**1. Excel 파일 생성**
- 파일명: `02 분반 합반할 학생 규칙.xlsx`

**2. Sheet1 구성**

**왼쪽 5개 열: 분반 규칙**
```
| 분반해야하는 학생 |   | ↔ |   |   |
| 반 | 이름 |   | 반 | 이름 |
| 1  | 김철수 |   | 2  | 이영희 |
| 3  | 박민수 |   | 4  | 최지우 |
```
→ 김철수와 이영희는 **다른 반**
→ 박민수와 최지우는 **다른 반**

**오른쪽 5개 열: 합반 규칙**
```
| 합반해야하는 학생 |   | ＋ |   |   |
| 반 | 이름 |   | 반 | 이름 |
| 2  | 오시후 |   | 2  | 오예아 |
| 5  | 정서윤 |   | 5  | 강도윤 |
```
→ 오시후와 오예아는 **같은 반**
→ 정서윤과 강도윤은 **같은 반**

**주의사항**:
- 첫 번째 행은 헤더 (자동으로 인식)
- 같은 학생 쌍이 분반과 합반에 동시에 있으면 오류
- 합반 그룹에 동명이인이 있으면 오류

### 출력 파일 상세

#### 결과 파일 구조

**시트 구성**:
1. `요약`: 반별 통계 한눈에 보기
2. `[학년]-1`, `[학년]-2`, ... : 각 반의 학생 명단
3. `규칙` ⭐ (NEW): 적용된 분반/합반 규칙

**예**: 6학년 7개 반 → `요약`, `6-1`, `6-2`, `6-3`, `6-4`, `6-5`, `6-6`, `6-7`, `규칙`

#### 요약 시트

| 반 | 학생수 | 유효인원 | 남학생수 | 여학생수 | 유효남학생 | 유효여학생 | 난이도합 | 특수반수 | 전출생수 |
|---|-------|---------|---------|---------|-----------|-----------|---------|---------|---------|
| 6-1 | 20 | 22.0 | 8 | 12 | 10.0 | 12.0 | 5.0 | 1 | 1 |
| 6-2 | 21 | 24.0 | 10 | 11 | 12.0 | 12.0 | 5.0 | 1 | 0 |

**유효 인원 계산 방식**:
- 일반 학생 1명 = 1명
- 특수반 학생 1명 = 3명 (교사 부담 고려)
- 전출 예정 학생 1명 = 0명 (실제 교육 대상 아님)

#### 각 반 시트

| 학년 | 반 | 번호 | 이름 | 성별 | 점수 | 특수반 | 전출 | 난이도 | 비고 | 원학년 | 원반 | 원번호 |
|-----|---|-----|-----|-----|-----|-------|-----|-------|------|-------|-----|-------|
| 6 | 1 | 1 | 강민준 | 남 | 92 | | | | | 5 | 3 | 12 |
| 6 | 1 | 2 | 김서연 | 여 | 90 | 1 | | 2.0 | 느티모반 | 5 | 1 | 8 |

**특징**:
- 학생은 **이름 가나다순**으로 정렬
- 새 번호는 가나다순으로 1번부터 부여
- **원학년, 원반, 원번호**: 이전 학년 정보 (학생 추적용)
- 분반 규칙 학생 셀에 **메모** 자동 추가: "분반 대상: OOO (X반)"

#### 규칙 시트 ⭐ (NEW)

결과 파일에 이제 **규칙 시트**가 포함됩니다!

**시트 구조**:
```
| 분반해야하는 학생 |   |   |   |   |   | 합반해야하는 학생 |   |   |   |
| 반 | 이름 | | 반 | 이름 |   | 반 | 이름 | | 반 | 이름 |
| ... | ... | | ... | ... |   | ... | ... | | ... | ... |
```

**규칙 시트의 장점**:
- ✅ **자급자족**: 결과 파일만 있으면 수동 조정 가능 (규칙 파일 불필요)
- ✅ **이동성**: 결과 파일을 다른 컴퓨터로 옮겨도 모든 정보 유지
- ✅ **추적성**: 어떤 규칙을 적용했는지 결과와 함께 영구 보관

---

## ❓ 자주 묻는 질문

### Q1. 규칙 파일 없이 결과만 있는데 수동 조정 가능한가요?

**A: 가능합니다!**

최신 버전은 결과 파일에 규칙이 포함되어 있습니다.

**방법**:
1. 프로그램 시작 화면에서 "📂 결과 파일 불러오기" 클릭
2. 결과 파일 (`03 배정 결과.xlsx`) 선택
3. 바로 수동 조정 가능

규칙 파일 (`02 분반 합반할 학생 규칙.xlsx`)이 없어도 됩니다.

---

### Q2. 수동 조정 후 다시 자동 배정하면 어떻게 되나요?

**A: 조정 내용이 사라집니다.**

**주의**:
- 수동 조정은 **현재 세션**에만 유효합니다
- 자동 배정을 다시 실행하면 **처음부터** 다시 배정됩니다
- 수동 조정 내용은 유지되지 않습니다

**해결**:
- 수동 조정 후 반드시 **"📥 Export to Excel"** 클릭하여 저장하세요
- 저장한 파일을 백업해두세요

---

### Q3. 특정 학생을 이동하려는데 "이동 가능한 반이 없습니다"라고 나옵니다

**A: 분반 규칙 때문입니다.**

**원인**:
해당 학생과 **분반해야 하는 학생**이 모든 다른 반에 이미 있어서 갈 곳이 없는 상태입니다.

**예시**:
```
김철수를 이동하려고 하는데...
- 2반에 이민준 있음 (분반 대상)
- 3반에 박지우 있음 (분반 대상)
- 4반에 최서윤 있음 (분반 대상)
- ...모든 반에 분반 대상이 있어서 이동 불가
```

**해결**:
1. 김철수의 제약사항 확인: `분반: 이민준(2반), 박지우(3반), ...`
2. 분반 대상 학생 중 **일부를 먼저 다른 반으로 이동**
3. 빈 자리가 생기면 김철수 이동

---

### Q4. 합반 그룹 학생을 이동하면 경고가 나옵니다

**A: 의도된 동작입니다.**

**이유**:
합반 그룹은 **같은 반에 있어야** 하는데, 한 명만 이동하면 그룹이 깨집니다.

**경고 예시**:
```
⚠️ 김철수 학생은 합반 그룹입니다.
그룹 구성원: 김철수, 이영희, 박민수
그룹에서 분리하시겠습니까?
```

**선택지**:
- **"예"**: 그룹을 깨고 김철수만 이동 (이영희, 박민수는 원래 반에 남음)
- **"아니오"**: 이동 취소

**그룹 전체를 이동하려면**:
각 학생을 **하나씩** 같은 대상 반으로 이동시키세요.

---

### Q5. 성적이나 성비를 자동으로 조정해주나요?

**A: 자동 배정에서는 자동, 수동 조정에서는 사용자 책임입니다.**

**자동 배정**:
- 성적, 성비, 학생 수, 난이도 등을 **자동으로** 균등하게 배분
- 알고리즘이 최대한 공정하게 배치

**수동 조정**:
- 시스템은 **규칙만 검사**합니다 (분반/합반/동명이인)
- 성적, 성비는 **사용자가 직접** 확인하고 조정해야 합니다
- 오른쪽 패널의 **통계**를 보면서 균형을 맞추세요

**팁**:
- 수동 조정은 **최소한**으로 하는 것이 좋습니다
- 자동 배정 결과가 이미 균형있게 배분되어 있습니다

---

### Q6. 몇 학년에 사용할 수 있나요?

**A: 모든 학년에 사용 가능합니다.**

프로그램은 **학년 자동 감지** 기능이 있습니다:
- 입력 파일에서 현재 학년을 읽음
- 자동으로 +1 학년으로 진급 처리
- 예: 5학년 → 6학년, 2학년 → 3학년

**제한 없음**:
- 초등학교, 중학교, 고등학교 모두 사용 가능
- 학급 수도 자유롭게 설정 (6개, 7개, 8개...)

---

## 🔧 문제 해결 가이드

### 문제 1: 프로그램이 실행되지 않습니다

**증상**:
- 더블클릭해도 아무 반응이 없음
- 또는 잠깐 창이 뜨다가 사라짐

**해결 방법**:

**Windows 사용자**:
1. 실행 파일 우클릭 → "관리자 권한으로 실행"
2. "Windows의 PC 보호" 경고 나오면:
   - "추가 정보" 클릭
   - "실행" 버튼 클릭

**macOS 사용자**:
1. 실행 파일 우클릭 → "열기" 클릭
2. 보안 경고 나오면:
   - "열기" 버튼 클릭
3. 또는 시스템 설정에서:
   - 시스템 설정 → 개인정보 보호 및 보안
   - "확인 없이 열기" 클릭

---

### 문제 2: "규칙 충돌" 오류가 나옵니다

**증상**:
```
⚠️ 규칙 충돌 발견!
❌ 김철수와 이영희는 합반해야 하지만 동시에 분반해야 함
```

**원인**:
규칙 파일에 모순된 규칙이 있습니다:
- 같은 학생 쌍이 분반과 합반에 **동시에** 등록됨
- 합반 그룹 안에 **동명이인**이 있음

**해결 방법**:
1. 규칙 파일 (`02 분반 합반할 학생 규칙.xlsx`) 열기
2. 오류 메시지에 나온 학생 이름 찾기
3. 분반 또는 합반 중 **하나만** 남기기
4. 저장 후 다시 실행

**예시**:
```
문제: 김철수-이영희가 분반과 합반 양쪽에 있음

해결:
- 분반 규칙에서 삭제 → 합반만 유지
또는
- 합반 규칙에서 삭제 → 분반만 유지
```

---

### 문제 3: 결과가 이상합니다 (한 반에 학생이 너무 적거나 많음)

**증상**:
- 어떤 반은 25명, 어떤 반은 15명
- 성비가 심하게 불균형 (남 15명, 여 5명)

**원인**:
합반 규칙이 많아서 특정 반에 학생이 몰렸습니다.

**이유**:
- 합반 규칙은 **최우선** 적용됩니다
- 많은 학생을 같은 반에 배치하라는 규칙이 많으면 그 반에 학생이 몰립니다

**해결 방법**:

**방법 1: 규칙 조정** (근본 해결)
1. 합반 규칙을 **줄이거나** 조정
2. 정말 필요한 합반만 남기기
3. 다시 자동 배정 실행

**방법 2: 수동 조정** (빠른 해결)
1. 자동 배정 결과를 일단 받아들이기
2. **수동 조정 기능** 사용하여 균형 맞추기
3. 오른쪽 통계를 보면서 학생 수 조정
4. 몰린 반에서 → 적은 반으로 학생 이동

---

### 문제 4: 수동 조정에서 학생을 이동할 수 없습니다

**증상**:
- 특정 학생 선택 → 이동 버튼 클릭
- "이동 가능한 반이 없습니다" 메시지 나타남

**원인**:
분반 규칙 때문에 갈 수 있는 반이 없습니다.

**해결 방법**:

**1단계: 제약사항 확인**
- 해당 학생의 색상 확인 (🟡 노란색 = 분반 규칙 있음)
- 학생 이름 옆 제약사항 확인:
  ```
  분반: 이민준(3반), 박지우(5반), 최서윤(7반)
  ```

**2단계: 분반 대상 학생 이동**
- 분반 대상 학생들을 먼저 **다른 반으로 이동**
- 예: 이민준을 3반 → 4반으로 이동

**3단계: 원하는 학생 이동**
- 이제 3반이 비었으므로 원하는 학생을 3반으로 이동 가능

**예시**:
```
문제: 김철수를 2반으로 이동하고 싶은데 안 됨

원인: 2반에 이미 분반 대상인 박민수가 있음
      김철수 - 분반: 박민수(2반), 최지우(4반)

해결:
1. 박민수를 2반 → 6반으로 이동
2. 김철수를 1반 → 2반으로 이동
```

---

### 문제 5: 파일을 선택했는데 "파일 형식이 올바르지 않습니다" 오류

**증상**:
- 파일 선택 후 "파일 형식이 올바르지 않습니다" 메시지

**원인**:
- Excel 파일이 아닌 파일 선택 (.csv, .txt 등)
- 시트 이름이 잘못됨
- 필수 열이 빠졌음

**해결 방법**:

**학생 명단 파일**:
- ✅ `.xlsx` 확장자 확인
- ✅ 시트 이름: `[학년]-[반]` 형식 (예: `5-1`, `5-2`)
- ✅ 필수 열: 학년, 반, 번호, 이름, 성별, 점수

**규칙 파일**:
- ✅ `.xlsx` 확장자 확인
- ✅ 시트 이름: `Sheet1`
- ✅ 헤더: 분반해야하는 학생, 합반해야하는 학생

**결과 파일**:
- ✅ `.xlsx` 확장자 확인
- ✅ `요약` 시트 존재
- ✅ 반 시트 존재 (예: `6-1`, `6-2`)

---

## 부록: 개발자를 위한 정보

### 배정 알고리즘 개요

프로그램은 **6단계 배정 알고리즘**을 사용합니다:

**Phase 0: 데이터 로드**
- 모든 학생 데이터 통합
- 성별별 등수(rank) 계산

**Phase 1: 규칙 적용** 🔴 (최우선)
- 합반 규칙 먼저 적용
- 분반 규칙 적용

**Phase 2: 특수반 학생 배치** 🟡
- 특수반 학생 균등 배치
- 유효 인원 기준

**Phase 3: 동명이인 분리** 🟡
- 같은 이름 학생 다른 반 배치

**Phase 4: 난이도 균등 배분** 🟢
- 지도 난이도 높은 학생 균등 배치

**Phase 5: 종합 균형 조정** 🟢
- 성비, 성적, 유효 인원 균형
- 동적 정렬 + 성비 균형

**Phase 6: 예비**
- Phase 5에서 모두 배정되어 실행 안 됨

### 유효 인원 개념

**유효 인원**은 교사 부담을 고려한 가중치 계산입니다:

- 일반 학생: **1명**
- 특수반 학생: **3명** (교사 부담 고려)
- 전출 예정 학생: **0명** (실제 교육 대상 아님)

**예시**:
```
반 학생 구성:
- 일반 학생: 19명
- 특수반 학생: 1명
- 전출 예정: 1명

학생 수 = 21명
유효 인원 = 19 × 1 + 1 × 3 + 1 × 0 = 22명
```

### 기술 스택

**핵심 엔진**:
- Python 3.9+
- pandas (데이터 처리)
- openpyxl (Excel 읽기/쓰기)
- numpy (수치 계산)

**GUI**:
- PyQt6 (크로스플랫폼 GUI)
- QThread (백그라운드 처리)

**배포**:
- PyInstaller (실행 파일 생성)

### 프로젝트 구조

```
Class_Assignment 2/
├── class_assigner.py              # 핵심 배정 엔진
├── class_assigner_gui_qt.py       # PyQt6 GUI 버전
├── main.py                        # CLI 진입점
├── build.sh                       # macOS 빌드 스크립트
├── requirements.txt               # Python 의존성
├── 01 가상 명단.xlsx              # 샘플 입력
├── 02 분반 합반할 학생 규칙.xlsx   # 샘플 규칙
├── dist/
│   └── 학급편성.app               # 빌드된 실행 파일
└── tests/                         # 단위 테스트
    ├── test_rule_validation.py
    ├── test_phase1_apply_rules.py
    └── ...
```

### 테스트 실행

```bash
# 모든 테스트 실행
pytest tests/ -v

# 특정 테스트 실행
pytest tests/test_rule_validation.py -v
```

### 버전 히스토리

**v2.5 (2025-01-16)**
- ✨ 규칙 임베딩: 결과 파일에 '규칙' 시트 추가
- ✨ 수동 조정 시 규칙 파일 불필요
- 🐛 수동 조정 GUI 안정성 개선

**v2.4 (2025-12-10)**
- ✨ 범용성 강화: 모든 학년 사용 가능
- ✨ 학년 자동 감지 기능

**v2.3 (2025-12-10)**
- ✨ Excel 출력 시각화 개선
- ✨ 분반 규칙 학생에 메모 자동 추가

**v2.2 (2025-12-10)**
- ✨ Phase 1 분반 규칙 로직 개선
- ✨ Phase 5 동적 정렬 + 성비 균형
- ✨ 유효 인원 개념 도입

**v2.0 (2025-11-21)**
- ✨ PyQt6 기반 GUI 추가
- 🎨 다크모드 자동 대응
- 📦 실행 파일 빌드 지원

**v1.0 (2025-11-20)**
- 🎉 최초 릴리스
- ✅ 6단계 배정 알고리즘 구현

---

## 라이선스

이 프로그램은 교육 목적으로 자유롭게 사용할 수 있습니다.

---

## 문의

프로그램 사용 중 문제가 발생하면 개발자에게 문의하세요.

**최종 업데이트**: 2025년 1월 16일
**현재 버전**: 2.5
